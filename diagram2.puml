@startuml
' Style Settings
'skinparam dpi 150
skinparam componentStyle rectangle
skinparam shadowing false
skinparam linetype ortho
skinparam defaultTextAlignment center

' COLORS (for easier reference)
' Blue      #1F77B4  (mDNS capture)
' Green     #2CA02C  (mDNS retransmit)
' Red       #C62828  (Direct data)
' Purple    #8E44AD  (Proxied data)
' Gray      #918df7  (Control / Commands)
' DB gray   #cf97b2

' --- GROUPS ---

rectangle "External Clients" as ClientsGroup {
  node "Wireless Client" as ClientWireless #FFFFFF
  node "Wired Client" as ClientWired #FFFFFF
}

rectangle "Remote VLAN A (Direct Segment)" as SiteA #FFF5E6 {
  rectangle "Smart Device A\n(Chromecast)" as DeviceA #FFE3C4
  component "Probe A\n(edumdns_probe)" as ProbeA #FFD59E
}

rectangle "Remote VLAN B" as SiteB #FFF5E6 {
  rectangle "Smart Device B\n(Apple TV)" as DeviceB #FFE3C4
  component "Probe B\n(edumdns_probe)" as ProbeB #FFD59E
}

rectangle "Central Host" as CentralHost #E9F2FB {
  rectangle "Server Stack" as ServerGroup #F6D36B {
    component "Server\n(edumdns_server)" as ServerComponent #FCE39B
    component "Web UI\n(edumdns_web)" as WebComponent #FCE39B
  }
  component "eBPF Proxy\n(edumdns_proxy)" as Proxy #FFF2CC
  database "DB Layer\n(edumdns_db)" as DBLayer #E6F2E6
}

database "Postgres" as Postgres #D9E1F2


' --- LINKS ---

' 0. Web -> Server (Command)
ServerComponent <-[#918df7,thickness=3]-> WebComponent : "<color:#918df7>Control</color>"

' 1. mDNS Capture (Device -> Probe)
DeviceA -[#1F77B4,thickness=2]-> ProbeA : "<color:#1F77B4>mDNS Capture</color>"
DeviceB -[#1F77B4,thickness=2]-> ProbeB : "<color:#1F77B4>mDNS Capture</color>"

' 2. Probe -> Server (mDNS Data + Control)
ProbeA -[#1F77B4,thickness=2]-> ServerComponent : "<color:#1F77B4>mDNS Data</color>"
ProbeB -[#1F77B4,thickness=2]-> ServerComponent : "<color:#1F77B4>mDNS Data</color>"

ProbeA <-[#918df7,thickness=2]-> ServerComponent : "<color:#918df7>Control</color>"
ProbeB <-[#918df7,thickness=2]-> ServerComponent : "<color:#918df7>Control</color>"

' 3. Server -> DB Layer -> Postgres
ServerGroup -[#cf97b2,thickness=2]-> DBLayer : "<color:#cf97b2>DB API</color>"
DBLayer -[#cf97b2,thickness=2]-> Postgres : "<color:#cf97b2>SQL</color>"

' 4. Server -> Proxy (Proxy Configuration)
ServerComponent -[#918df7,thickness=2]-> Proxy : "<color:#918df7>Proxy Config</color>"

' 5. Server -> Clients (mDNS Retransmission)
ServerComponent -[#2CA02C,thickness=2]-> ClientWireless : "<color:#2CA02C>mDNS Advert</color>"
ServerComponent -[#2CA02C,thickness=2]-> ClientWired : "<color:#2CA02C>mDNS Advert</color>"

' 6. DATA TRAFFIC

' Segment A (direct)
ClientWired <-[#C62828,thickness=3]-> DeviceA : "<color:#C62828>Direct Data</color>"

' Segment B (proxied)
ClientWireless <-[#8E44AD,thickness=3]-> Proxy : "<color:#8E44AD>Proxied Data</color>"
Proxy <-[#8E44AD,thickness=3]-> DeviceB : "<color:#8E44AD>Proxied Data</color>"

@enduml
