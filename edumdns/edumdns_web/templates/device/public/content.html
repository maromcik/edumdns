<div id="transmit-form" class="max-w-7xl mx-auto px-4 sm:px-8">
    <section class="text-center py-12 mb-3">
        <h2 class="text-3xl md:text-4xl font-extrabold text-sat-xl mb-8 tracking-tight">
            Discover the device {% if device.name is none %} {{ device.id }} {% else %} {{ device.name }} {% endif %}
        </h2>

        <!-- Device Info Card -->
        <div class="rounded-xl bg-cards p-8 shadow-lg mb-10 text-left">
            <h3 class="text-xl md:text-2xl font-semibold mb-6 text-sat-l flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-acc" fill="none" viewBox="0 0 24 24"
                     stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2a4 4 0 014-4h6"/>
                </svg>
                Device Information
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                {% for label, value in [
                ("ID", device.id),
                ("Name", device.name),
                ("Device MAC", device.mac),
                ("Device IP", device.ip),
                ("Transmit Duration", device.duration ~ " seconds"),
                ("Transmit Interval", device.interval ~ " ms"),
                ("Via Proxy", device.proxy)
                ] %}
                <div class="flex flex-col">
                    <span class="text-xs uppercase tracking-wide text-sat-m">{{ label }}</span>
                    <span class="font-mono text-code truncate"><code>{{ value }}</code></span>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Client IP + Transmission Controls -->
        <!-- Prettified transmit-result section -->
        <div id="transmit-result" class="mt-10">
            <div class="rounded-2xl bg-cards p-10 shadow-xl">
                <div class="flex flex-col items-center justify-center gap-8">

                    <!-- Your IP -->
                    <div class="flex flex-col items-center gap-3">
        <span class="text-sm uppercase tracking-wide text-sat-l font-semibold flex items-center gap-2">
          <i class="fa-solid fa-network-wired text-acc"></i>
          Your IP Address
        </span>
                        <div class="px-6 py-3 bg-green-50 border border-green-200 rounded-lg shadow-sm">
                            <span class="text-2xl font-mono text-green-700 tracking-tight select-all">{{ client_ip }}</span>
                        </div>
                    </div>

                    {% if in_progress is not none and packet_transmit_request is none %}

                    <!-- Warning: Transmission in progress -->
                    <div class="w-full max-w-lg bg-yellow-50 border-l-4 border-yellow-500 text-yellow-900 p-5 rounded-md shadow-sm text-left">
                        <div class="flex items-center gap-3">
                            <i class="fa-solid fa-triangle-exclamation text-yellow-600 text-xl"></i>
                            <h3 class="text-lg font-semibold">Discovery In Progress</h3>
                        </div>
                        <p class="mt-2 text-sm">
                            Another discovery for this device is currently running.
                            Please wait until it completes on <span class="font-mono">{{ in_progress.until }}</span>.
                        </p>
                    </div>

                    {% else %}

                    <!-- Transmission Controls -->
                    <div class="flex flex-col items-center justify-center gap-8 w-full">

                        {% if packet_transmit_request is not none %}

                        <!-- Discovery Active -->
                        {% if packet_transmit_request.until is not none %}
                        <div class="text-center">
                            <div class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-green-50 border border-green-200 text-green-800 shadow-sm">
                                <i class="fa-solid fa-clock text-green-600"></i>
                                <span class="font-medium">Discovery active until
              <span class="font-mono text-green-700">{{ packet_transmit_request.until }}</span>
            </span>
                            </div>
                        </div>
                        {% endif %}

                        <!-- Stop Button -->
                        <button
                                hx-delete="/device/{{ device.id }}/transmit/{{ packet_transmit_request.id }}?return_url=/device/{{ device.id }}/transmit"
                                hx-target="#content-area"
                                hx-target-error="#transmit-result"
                                type="submit"
                                class="inline-flex items-center justify-center gap-3 rounded-xl border border-red-600 bg-red-500 text-white px-6 py-3 text-lg font-semibold shadow-sm hover:bg-red-600 focus:ring-2 focus:ring-red-400 transition"
                        >
                            <i class="fa-solid fa-stop"></i>
                            Stop Discovery
                        </button>

                        <!-- Extend Discovery Form -->
                        <form
                                method="post"
                                hx-post="/device/{{ device.id }}/transmit/{{ packet_transmit_request.id }}/extend?return_url=/device/{{ device.id }}/transmit"
                                hx-target="#content-area"
                                hx-target-error="#transmit-result"
                                class="flex flex-col items-center gap-5 w-full max-w-sm bg-base/10 p-6 rounded-xl border border-base/20 shadow-sm"
                        >
                            {% if device.acl_pwd_hash is not none %}
                            <div class="w-full text-left">
                                <label for="acl_pwd_extend"
                                       class="text-xs uppercase tracking-wide text-sat-l mb-1 block">Password</label>
                                <input
                                        id="acl_pwd_extend"
                                        name="acl_pwd"
                                        type="password"
                                        class="w-full rounded-md border border-base bg-bg px-3 py-2 bg-panes text-sat-l focus:outline-none focus:ring-2 focus:ring-acc placeholder-sat-m"
                                        placeholder="Enter password"
                                >
                            </div>
                            {% endif %}

                            <button
                                    type="submit"
                                    class="inline-flex items-center justify-center gap-3 rounded-xl border border-blue-600 bg-blue-500 text-white px-6 py-3 text-lg font-semibold shadow-sm hover:bg-blue-600 focus:ring-2 focus:ring-blue-400 transition"
                            >
                                <i class="fa-solid fa-arrows-rotate"></i>
                                Extend Discovery
                            </button>
                        </form>

                        {% else %}

                        <!-- Initial Discover Form -->
                        <form
                                method="post"
                                hx-post="/device/{{ device.id }}/transmit"
                                hx-target="#content-area"
                                hx-target-error="#transmit-result"
                                class="flex flex-col items-center gap-5 w-full max-w-sm bg-base/10 p-6 rounded-xl border border-base/20 shadow-sm"
                        >
                            {% if device.acl_pwd_hash is not none %}
                            <div class="w-full text-left">
                                <label for="acl_pwd" class="text-xs uppercase tracking-wide text-sat-l mb-1 block">Password</label>
                                <input
                                        id="acl_pwd"
                                        name="acl_pwd"
                                        type="password"
                                        class="w-full rounded-md border border-base bg-bg px-3 py-2 bg-panes text-sat-l focus:outline-none focus:ring-2 focus:ring-acc placeholder-sat-m"
                                        placeholder="Enter password"
                                >
                            </div>
                            {% endif %}

                            <button
                                    type="submit"
                                    class="inline-flex items-center justify-center gap-3 rounded-xl border border-green-600 bg-green-500 text-white px-6 py-3 text-lg font-semibold shadow-sm hover:bg-green-600 focus:ring-2 focus:ring-green-400 transition"
                            >
                                <i class="fa-solid fa-search"></i>
                                Discover
                            </button>
                        </form>

                        {% endif %}
                    </div>

                    {% endif %}
                </div>
            </div>
        </div>

    </section>
</div>
