<!-- User Detail Content -->
<div class="2xl:w-1/2 lg:w-3/4 w-full mx-auto px-4 sm:px-8 mb-10 md:mb-6">

    <!-- Header -->
    <div class="flex items-center justify-between mb-4">
        <h2 class="text-3xl font-bold text-sat-xl">
            {{ target_user.user.name }} {{ target_user.user.surname }}
        </h2>
        <button
                hx-delete="/user/{{ target_user.user.id }}"
                hx-confirm="Are you sure you want to delete this user?"
                class="flex items-center justify-center w-10 h-10 bg-red-600 hover:bg-red-700 rounded-md text-button shadow-md"
                title="Delete user"
                aria-label="Delete user"
                hx-target="#content-area"
                hx-target-error="#content-area"
                hx-push-url="/user"
        >
            <i class="fa-solid fa-trash"></i>
        </button>
    </div>

    <!-- User Card -->
    <!-- Editable User Settings -->
    <div class="rounded-lg border border-base bg-cards p-6 mb-8">
        <h3 class="text-2xl font-medium mb-4 text-sat-l">User Settings</h3>
        <div class="flex flex-col mb-4">
            <span class="text-xs uppercase tracking-wide text-sat-m">ID</span>
            <span class="font-mono text-code"><code>{{ target_user.user.id }}</code></span>
        </div>
        <form
                method="post"
                hx-post="/user/update"
                hx-target="#content-area"
                hx-target-error="#content-area"
                class="grid grid-cols-1 md:grid-cols-2 gap-4"
        >
            <input type="hidden" id="user_id" name="id" value="{{ target_user.user.id }}"/>

            <!-- Name -->
            <div class="flex flex-col">
                <label for="name" class="text-xs uppercase tracking-wide text-sat-l">Name</label>
                <input
                        id="name"
                        name="name"
                        type="text"
                        value="{{ target_user.user.name }}"
                        placeholder="First name"
                        class="mt-1 rounded-md border border-base bg-panes px-3 py-2 text-sat-l focus:outline-none focus:ring-2 focus:ring-acc"
                />
            </div>

            <!-- Surname -->
            <div class="flex flex-col">
                <label for="surname" class="text-xs uppercase tracking-wide text-sat-l">Surname</label>
                <input
                        id="surname"
                        name="surname"
                        type="text"
                        value="{{ target_user.user.surname }}"
                        placeholder="Surname"
                        class="mt-1 rounded-md border border-base bg-panes px-3 py-2 text-sat-l focus:outline-none focus:ring-2 focus:ring-acc"
                />
            </div>

            <!-- Email -->
            <div class="flex flex-col md:col-span-2">
                <label for="email" class="text-xs uppercase tracking-wide text-sat-l">Email</label>
                <input
                        id="email"
                        name="email"
                        type="email"
                        value="{{ target_user.user.email }}"
                        placeholder="user@example.com"
                        class="mt-1 rounded-md border border-base bg-panes px-3 py-2 text-sat-l focus:outline-none focus:ring-2 focus:ring-acc"
                />
            </div>

            <!-- Admin + Disabled -->
            <div class="flex items-center gap-4 md:col-span-2 mt-2">
                <label class="inline-flex items-center">
                    <input
                            type="checkbox"
                            name="admin"
                            value="true"
                            class="rounded border-gray-300 text-acc focus:ring-acc"
                            {% if target_user.user.admin %}checked{% endif %}
                    />
                    <span class="ml-2 text-sat-l">Admin</span>
                </label>

                <label class="inline-flex items-center">
                    <input
                            type="checkbox"
                            name="disabled"
                            value="true"
                            class="rounded border-gray-300 text-acc focus:ring-acc"
                            {% if target_user.user.disabled %}checked{% endif %}
                    />
                    <span class="ml-2 text-sat-l">Disabled</span>
                </label>
            </div>

            <!-- Actions -->
            <div class="md:col-span-2 flex items-center gap-2 pt-2">
                <button
                        type="submit"
                        class="inline-flex items-center rounded-md bg-acc px-4 py-2 text-sm font-medium text-acc-cta hover:bg-acc-xl transition-colors"
                >
                    Save
                </button>
                <button
                        type="reset"
                        class="inline-flex items-center rounded-md text-button px-4 py-2 text-sm font-medium bg-acc-l hover:bg-panes transition-colors"
                >
                    Reset
                </button>
            </div>
        </form>
    </div>

    <!-- Editable User Settings -->
    <div class="rounded-lg border border-base bg-cards p-6 mb-8">
        <h3 class="text-2xl font-medium mb-4 text-sat-l">User Password</h3>
        <form
                method="post"
                hx-post="/user/update-pwd"
                hx-target="#content-area"
                hx-target-error="#content-area"
                class="grid grid-cols-1 md:grid-cols-2 gap-4"
        >
            <input type="hidden" id="user_id_pwd" name="id" value="{{ target_user.user.id }}"/>

            <!-- Name -->
            <div class="flex flex-col">
                <label for="new_password" class="text-xs uppercase tracking-wide text-sat-l">Password</label>
                <input
                        id="new_password"
                        name="new_password"
                        type="password"
                        placeholder="Enter a new password"
                        class="mt-1 rounded-md border border-base bg-panes px-3 py-2 text-sat-l focus:outline-none focus:ring-2 focus:ring-acc"
                />
            </div>

            <!-- Surname -->
            <div class="flex flex-col">
                <label for="confirm_password" class="text-xs uppercase tracking-wide text-sat-l">Confirm Password</label>
                <input
                        id="confirm_password"
                        name="confirm_password"
                        type="password"
                        placeholder="Enter the password again"
                        class="mt-1 rounded-md border border-base bg-panes px-3 py-2 text-sat-l focus:outline-none focus:ring-2 focus:ring-acc"
                />
            </div>

            <!-- Actions -->
            <div class="md:col-span-2 flex items-center gap-2 pt-2">
                <button
                        type="submit"
                        class="inline-flex items-center rounded-md text-button bg-acc px-4 py-2 text-sm font-medium text-acc-cta hover:bg-acc-xl transition-colors"
                >
                    Save
                </button>
                <button
                        type="reset"
                        class="inline-flex items-center rounded-md bg-acc-l px-4 py-2 text-sm font-medium text-button hover:bg-panes transition-colors"
                >
                    Reset
                </button>
            </div>
        </form>
    </div>

    <!-- Add Users to Group -->
    <div class="rounded-lg border border-base bg-cards p-6 mb-8">
        <h3 class="text-2xl font-semibold text-sat-l mb-4">Add this user to groups</h3>

        <form
                id="add-groups-form"
                hx-post="/user/{{ target_user.user.id }}/groups/add"
                hx-target="#content-area"
                hx-target-error="#content-area"
                hx-swap="innerHTML"
                hx-params="*"
                class="space-y-4"
        >
            <!-- Search box -->
            <div class="relative">
                <label for="group-search" class="sr-only">Search groups</label>
                <input
                        id="group-search"
                        name="q"
                        type="text"
                        placeholder="Search users by name or email..."
                        class="w-full rounded-md border border-base bg-panes px-3 py-2 text-sat-l"
                        hx-get="/user/{{ target_user.user.id }}/search"
                        hx-trigger="keyup changed delay:300ms"
                        hx-target="#group-search-results"
                        hx-swap="innerHTML"
                        hx-params="q"
                />
                <p class="text-xs text-sat-m mt-1">Type to search. Select users below to add.</p>
            </div>

            <!-- Dropdown-like results list (populated by search_users) -->
            <div class="relative">
                <div
                        id="group-search-results"
                        class="max-h-64 overflow-auto rounded-md border border-base bg-panes"
                        aria-live="polite"
                >
                    <div class="px-3 py-2 text-sat-m">Start typing to search for groupsâ€¦</div>
                </div>
            </div>

            <!-- Submit -->
            <div class="flex justify-end gap-2">
                <button
                        type="submit"
                        class="inline-flex items-center gap-2 rounded-md bg-acc px-3 py-2 text-sm text-button font-medium hover:bg-muted/20 transition-colors"
                        title="Add selected users"
                        aria-label="Add selected users"
                >
                    <i class="fa-solid fa-user-plus"></i>
                    Add groups
                </button>
            </div>
        </form>
    </div>

    <div id="user-groups" class="rounded-lg border border-base bg-cards p-6">
        <h3 class="text-2xl font-semibold text-sat-l mb-4">Groups for this user</h3>

        {% if groups|length > 0 %}
        <div class="overflow-x-auto rounded-lg">
            <table class="min-w-full divide-y divide-base">
                <thead class="bg-muted/10">
                <tr>
                    <th class="px-4 py-3 text-left text-xs text-sat-l font-medium uppercase tracking-wider text-muted-foreground">ID</th>
                    <th class="px-4 py-3 text-left text-xs text-sat-l font-medium uppercase tracking-wider text-muted-foreground">Name</th>
                    <th class="px-4 py-3 text-left text-xs text-sat-l font-medium uppercase tracking-wider text-muted-foreground">Description</th>
                    <th class="px-4 py-3 text-left text-xs text-sat-l font-medium uppercase tracking-wider text-muted-foreground">Actions</th>
                </tr>
                </thead>
                <tbody class="divide-y divide-base">
                {% for g in groups %}
                <tr class="cursor-pointer rounded-lg bg-table transition-colors" data-href="/group/{{ g.id }}">
                    <td class="px-4 py-3 font-mono text-sm text-sat-l"><a href="/group/{{ g.id }}">{{ g.id }}</a></td>
                    <td class="px-4 py-3 text-sm text-sat-l">{{ g.name }}</td>
                    <td class="px-4 py-3 text-sm text-sat-l">{{ g.description[:13] }}</td>
                    <td class="px-4 py-3 text-sm text-sat-l">
                        <button
                                hx-get="/group/{{ g.id }}/users/{{ target_user.user.id }}/delete?return_url=/user/{{ target_user.user.id }}"
                                hx-target="#content-area"
                                hx-target-error="#content-area"
                                hx-push-url="/user/{{ g.id }}"
                                class="inline-flex items-center rounded-md px-3 py-1 text-sm text-red-400 hover:text-red-500 hover:bg-muted/20 transition-colors"
                                title="Delete user from group"

                        >
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </td>

                </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="p-4 text-muted-foreground">User is in no groups.</div>
        {% endif %}
    </div>

</div>

<script>
    document.querySelectorAll("tr[data-href]").forEach(row => {
        row.addEventListener("click", e => {
            if (
                e.target.closest("a, button, input, textarea") ||
                window.getSelection().toString().length > 0
            ) {
                return;
            }
            window.location = row.dataset.href;
        });
    });
</script>